---
title: "A Simulation Study"
description: 
  Creating a Visual Inference 
author: Veronica De Leon
date: November 8, 2024
format:
  html:
    code-fold: true
    code-summary: "Show the code"
message: false
warning: false
---

```{r}
library(openintro)
library(tidyverse)
library(stringr)
```

### About the Data

For this project, I used the 'Dream' data set from the openintro package. The data set came from SurveyUSA, News Poll and was collected on January 27-29, 2012. The poll survered the views of 910 people on the DREAM Act (a legislative proposed to give undocumented immigrants temporary residency so that they could work in the US). Those surveyed were categorized into three ideologies: Liberal, Moderate, and Conservative. Their responses were either No, Not Sure, or Yes.

### About the Simulation

From the observed data of the data set, I noticed that the proportion of Liberals in support of the Dream Act (0.65) is greater than the proportion of Conservatives (0.5) and the proportion of Moderates (0.48). So, I set to test if there is truly a relationship between ideology and whether or not they are in support of the DREAM Act by comparing null plots and the observed plot.

Under the null, the proportions between ideologies and responses are equal. So, when we compare the null plots and observed plot, we are checking to see if our observed plot differs from the null plots. If we can identify the observed plot from the null plots, then this gives us evidence to reject the null, and believe that there is a relationship between ideology and their support of the DREAM Act.

### Simulation

Here is the "statistic" in a form of a bar graph. This is our observed plot as it uses the information provided by the data set.

```{r}
obs_dream <- dream |>
  group_by(ideology) |>
  mutate(ideology = as.character(ideology)) |>
  mutate(ideology = str_extract(ideology, "\\w")) |> 
  mutate(ideology = as.factor(ideology)) |>
  mutate(ideology = fct_relevel(ideology, c("L", "M", "C"))) |>
  mutate(repeated = 7) 

obs_dream|>
   ggplot(aes(x = ideology, fill = stance)) +
    geom_bar() +
    facet_wrap(~repeated)

```

This code

```{r}
#function to permute
random_dream <- function(repeated, num_ideology){
  ideology = sample(c("L", "M", "C"), size = num_ideology, replace = TRUE)
  stance = sample(c("Yes", "No", "Not sure"))
  data.frame(repeated = repeated, ideology = as.factor(ideology), stance = stance) |>
    group_by(ideology) |>
    mutate(ideology = fct_relevel(ideology, c("L", "M", "C"))) |>
    mutate(stance = fct_relevel(stance, c("No", "Not sure", "Yes")))
} 
```

```{r}
#under the null
set.seed(47)
null_dream_one <- map((1:6), random_dream, num_ideology = 909)|>
    list_rbind() 

null_dream_two <- map((8:20), random_dream, num_ideology = 909) |>
  list_rbind() 

```

```{r}
#to plot all the graphs
rbind(obs_dream, null_dream_one, null_dream_two) |>
  ggplot(aes(x = ideology, fill = stance)) +
  geom_bar() +
  facet_wrap(~repeated) +
  labs(x = "Ideology", y = "Proportion of Responses", title = "Comparison of Null Plots vs. Observed Plot", fill = "Stance")
```
